var SM={CONST:{history:"sm-history",current:"sm-current",viewportId:"sm-viewport",menuClass:"sm-menu",itemClass:"sm-item",backItemClass:"sm-back-item",redirectItemClass:"sm-redirect-item",redirectBlankItemClass:"sm-redirect-blank-item",clearItemClass:"sm-clear-item",itemContainerClass:"sm-item-container",mainMenuId:"sm-main-menu",mainLayoutClass:"sm-main-layout",layoutClass:"sm-layout",currentLayoutClass:"sm-current-layout",layoutItemData:"item",gotoData:"goto",inAnimData:"smIn",outAnimData:"smOut"},Graph:class Graph{constructor(options){this._saving=options&&options.shouldSave!==undefined?options.shouldSave:true;this._layoutGetter=options&&options.layoutMap?options.layoutMap:()=>{return"main"};this._shouldLog=options&&options.logError!==undefined?options.logError:true;this._playFirstAnimation=options&&options.playFirstAnimation!==undefined?options.playFirstAnimation:true;this._beforeAnimationFunc=[];this._afterAnimationFunc=[];this._observer=new MutationObserver(this.forceUpdateLayout.bind(this));this._observer.observe(document.getElementById(SM.CONST.viewportId),{attributes:true,childList:true,subtree:true});if(this._setAttributes()){this._buildGraph();if(this._playFirstAnimation){const inAnimation=this._current.dataset[SM.CONST.inAnimData]?this._current.dataset[SM.CONST.inAnimData]:"SM.Animations.standardIn";this._playAnimation(inAnimation,this._current,false)}else{this._current.style.display=""}}}get currentMenu(){return this._current}_setAttributes(){if(document.getElementById(SM.CONST.mainMenuId)){if(this._saving&&typeof Storage!=="undefined"){this._history=sessionStorage.getItem(SM.CONST.history)?sessionStorage.getItem(SM.CONST.history).split(","):[];this._current=document.getElementById(`${sessionStorage.getItem(SM.CONST.current)?sessionStorage.getItem(SM.CONST.current):SM.CONST.mainMenuId}`)}else{this._history=[];this._current=document.getElementById(SM.CONST.mainMenuId)}this._nodes={};return true}console.log(`No main menu declared (${SM.CONST.mainMenuId})`);return false}_buildGraph(){const graph=this;const menuViewport=document.getElementById(SM.CONST.viewportId);const nodes=menuViewport.querySelectorAll(`#${SM.CONST.viewportId} .${SM.CONST.menuClass}`);for(let node of nodes){const nodeId=node.id;node.style.display="none";if(nodeId)graph._nodes[nodeId]=node;else this._logError("No id found",node);this._populateLayouts(node)}const items=menuViewport.getElementsByClassName(SM.CONST.itemClass);for(let item of items){const label=item.dataset[SM.CONST.gotoData];const isBlank=item.classList.contains(SM.CONST.redirectBlankItemClass);if(!item.classList.contains(SM.CONST.redirectItemClass)&&!isBlank)item.addEventListener("click",()=>graph.goto(label,item.classList.contains(SM.CONST.backItemClass),item.classList.contains(SM.CONST.clearItemClass)));else item.addEventListener("click",()=>graph._redirect(label,isBlank))}const linkItems=menuViewport.querySelectorAll(`.${SM.CONST.redirectItemClass}:not(.${SM.CONST.itemClass}), .${SM.CONST.redirectBlankItemClass}:not(.${SM.CONST.itemClass})`);for(let item of linkItems){const isBlank=item.classList.contains(SM.CONST.redirectBlankItemClass);item.addEventListener("click",()=>graph._redirect(item.dataset[SM.CONST.gotoData],isBlank))}}_populateLayouts(menu){const mainLayout=menu.querySelector(`.${SM.CONST.mainLayoutClass}`);const layouts=menu.querySelectorAll(`.${SM.CONST.layoutClass}:not(.${SM.CONST.mainLayoutClass})`);for(let layout of layouts){const containers=layout.getElementsByClassName(SM.CONST.itemContainerClass);for(let container of containers){const itemsToAppend=mainLayout.querySelector(`.${container.dataset[SM.CONST.layoutItemData]}`);if(itemsToAppend)container.appendChild(itemsToAppend.cloneNode(true));else this._logError("No data-item attribute in container.",container)}layout.style.display="none"}mainLayout.classList.add(SM.CONST.currentLayoutClass);this._setCorrectLayout(menu)}_setCorrectLayout(menu){const layoutToShow=this._getLayoutName(menu.id);const currentLayout=menu.querySelector(`.${SM.CONST.currentLayoutClass}`);if(!currentLayout.classList.contains(layoutToShow)){const newLayout=menu.querySelector(`.${layoutToShow}`);currentLayout.classList.remove(SM.CONST.currentLayoutClass);currentLayout.style.display="none";newLayout.classList.add(SM.CONST.currentLayoutClass);newLayout.style.display=""}}forceUpdateLayout(){this._setCorrectLayout(this._current)}goto(label,isBack=false,clearHistory=false){const oldHistory=this._history;let to;let inAnimation,outAnimation;if(!isBack){if(this._nodes[label]){this._history.push(this._current.id);to=this._nodes[label]}else{this._logError(`${label} is not a valid menu in ${this._current.id}`);return false}}else if(this._history&&this._history.length>0){let toId="";if(label){for(toId=this._history.pop();this._history.length>0&&toId!=label;toId=this._history.pop());}to=document.getElementById(`${toId?toId:this._history.pop()}`)}else{this._logError(`${this._current.id} cannot go back, no previous menu found.`);return false}this._setCorrectLayout(to);outAnimation=this._current.dataset[SM.CONST.outAnimData]?this._current.dataset[SM.CONST.outAnimData]:"SM.Animations.standardOut";inAnimation=to.dataset[SM.CONST.inAnimData]?to.dataset[SM.CONST.inAnimData]:"SM.Animations.standardIn";for(let func of this._beforeAnimationFunc){if(!func(this._current,to)){this._history=oldHistory;return false}}this._playAnimation(outAnimation,to,isBack);this._playAnimation(inAnimation,to,isBack);for(let func of this._afterAnimationFunc)func(this._current,to);this._current=to;if(clearHistory)this._history=[];this._saveCurrentState();return true}addDataCallback(callback,beforeAnimation){if(beforeAnimation)this._beforeAnimationFunc.push(callback);else this._afterAnimationFunc.push(callback)}_redirect(link,isBlank){window.open(link,isBlank?"_blank":"_self")}_playAnimation(animation,to,isBack){let animationContext=window;const contexts=animation.split(".");const animationFunction=contexts.pop();for(let context of contexts)animationContext=animationContext[context];animationContext[animationFunction].call(animationContext,this._current,to,isBack)}_saveCurrentState(){if(this._saving&&typeof Storage!=="undefined"){sessionStorage.setItem(SM.CONST.history,this._history.toString());sessionStorage.setItem(SM.CONST.current,this._current.id)}}_getLayoutName(menuName){const newLayout=`sm-${this._layoutGetter(menuName)}-layout`;return document.getElementById(menuName).querySelector(`.${newLayout}`)?newLayout:SM.CONST.mainLayoutClass}_logError(logList){if(this._shouldLog){if(logList instanceof Object)console.error.apply(this,logList);else console.error(logList)}}},Animations:class SMAnimations{static standardIn(from,to,isBack){to.style.display=""}static standardOut(from,to,isBack){from.style.display="none"}}};